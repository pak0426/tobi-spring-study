# 4. 예외

자바 개발자가 가장 신경 쓰기 귀찮아하는 것 중의 하나가 바로 예외처리다. 정상적인 결과와 흐름을 보여주는 코드를 만들기도 버거운데 예외상황까지 처리해야 한다는 사실이 부담스러울 수도 있다. 그래서 예외와 관련된 코드는 자주 엉망이 되거나 무성의하게 만들어지기 쉽다. 때론 잘못된 예외처리 코드 때문에 찾기 힘든 버그를 낳을 수도 있고, 생각지 않았던 예외상황이 발생했을 때 상상 이상으로 난처해질 수도 있다.


## 4.1 사라진 SQLException

3장에서 JdbcContext 로 만들었던 코드를 스프링의 JdbcTemplate 을 적용하도록 바꾸면서 설명하지 않고 넘어간 부분이 있다. JdbcTemplate 으로 바꾸기 전과 후의 deleteAll() 메서드를 비교해보고 무엇이 달라졌는지 찾아보자.

JdbcTemplate 적용 전
```java
public void deleteAll() throws SQLException {
   this.jdbcContext.executeSql("delete from users"); 
}
```

JdbcTemplate 적용 후
```java
public void deleteAll() throws SQLException {
   this.jdbcTemplate.update("delete from users"); 
}
```

### 4.1.1 초난감 예외처리

#### 예외 블랙홀

아래 코드는 기본적인 JDBC 코드이다.

```java
try{
    // ...
}
catch(SQLException e) {

}
```

JDBC API를 사용하면 IDE가 친절하게 빨간  줄을 그어주며 '처리되지 않은 예외가 있다'고 에러 표시를 해준다. 이를 보고 자바 언어 기초 시간에 배운 대로 try/catch 블록을 둘러싸주는 것으로 해결한다. 컴파일러 에러 메시지도 없어지고 간단한 예제에서라면 별문제 없이 잘 동작한다.

예외가 발생하면 그것을 catch 블록을 써서 잡아내는 것까지는 좋은데 그리고 아무것도 하지 않고 별문제 없는 것처럼 넘어가 버리는 건 정말 위험한 일이다. 원치 않은 예외가 발생하는 것보다도 훨씬 더 나쁜 일이다. 왜냐하면 프로그램 실행 중에 어디선가 오류가 있어서 예외가 발생했는데 그것을 무시하고 계속 진행해버리기 때문이다. 결국 발생한 예외로 인해 어떤 기능이 비정상적으로 동자하거나, 메모리나 리소스가 소진되거나, 예상치 못한 다른 문제를 일으킬 것이다. 최종적으로 오작동을 하거나 시스템 오류가 나서 운영자가 알아차렸을 때는 이미 조치를 취하기엔 너무 늦었다.

아래 코드도 마찬가지다.

```java
} catch (SQLException e) {
    System.out.println(e);    
}
```

```java
} catch (SQLException e) {
    e.printStackTrace();    
}
```
예외가 발생하면 화면에 출력해주는데 뭐가 문제일까? 개발 중에는 IDE 콘솔이나 서버 실행창에 이 메시지가 눈에 확 띄게 보이니 문제가 생겨도 금방 알아차리고 뭔가 조취를 취할 수 있을지 모르겠다. 그래 봤자 다른 로그나 메시지에 금방 묻혀버리면 놓치기 쉽상이다. 운영서버에 올라가면 더욱 심각하다. 콘솔 로그를 누군가가 계속 모니터링 하지 않는 한 이 예외 코드는 심각한 폭탄으로 남아있을 것이다. **예외는 처리돼야 한다.** 그런데 위의 코드들은 catch 블록을 이용해 화면에 메시지를 출력한 것은 예외를 처리한 게 아니다.

예외를 처리할 때 반드시 지켜야 할 핵심 원칙은 한 가지다. **모든 예외는 적절하게 복구되든지 아니면 작업을 중단시키고 운영자 또는 개발자에게 분명하게 통보돼야 한다.** 

SQLException이 발생하는 이유는 SQL에 문법 에러가 있거나 DB에서 처리할 수 없을 정도로 데이터 액세스 로직에 심각한 버그가 있거나, 서버가 죽거나 네트워크가 끊기는 등의 심각한 상황이 벌어졌기 때문이다. 그런데 그냥 예외를 무시하고 정상적으로 동작하는 있는 것처럼 모른 척 다음 코드로 실행을 이어간다는 건 말이 되지 않는다. 콘솔이나 로그에 예외 메시지를 출력하는 건 아무런 도움이 되지 않다. 아래와 같이 만드는게 백 배 낫다.

```java
} catch (SQLException e) {
    e.printStackTrace();
    System.exit(1);
}
```
물론 실전에서 이렇게 만들라는 건 아니다. 예외를 무시하거나 잡아먹어 버리는 코드는 만들지 말라는 뜻이다.

#### 무의미하고 무책임한 throws

